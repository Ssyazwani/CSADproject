<!DOCTYPE html>
<html>
<head>
  <title>My Bookings</title>
  <style>

    body {
      font-family: Arial, Helvetica, sans-serif;
      margin: 0;
      padding: 40px;
      background-color:#b1cce8;
      color: #3C4142;
    }

    h1 {
      text-align: left;
      margin-bottom: 40px;
    }
    h2 {
      text-align: left;
      margin-bottom: 40px;
    }

    /*For Header*/
    header {
      display: flex;
      gap: 50px;
      padding: 10px;
      margin: 3px 0;
      margin-right: 50px 0;
      box-sizing: border-box;
      background-color: #cfecf7;
    }
    /*For Header hyperlinks*/
    header a {
            margin-right: 30px;   /* space between links */
            font-weight: bold;
    }

    .booking-card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      max-width: 400px;
      position: relative;
      background-color: #cfecf7;
    }
    
    .booking-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 6px;
    }

    .cancel-btn {
      position: absolute;
      top: 12px;
      right: 12px;
      background-color: #ff4d4d;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }

    .cancel-btn:hover {
      background-color: #ff1a1a;
    }

  </style>
</head>
<body>
<h2>My Bookings</h2>
<div id="bookingList"></div>

<a href="/book.html">
  <button>Make a Booking</button>
</a>

<br>

<script>
function formatDate(dateStr) {
  const d = new Date(dateStr);
  return d.toLocaleDateString("en-GB", {
    day: "2-digit",
    month: "short",
    year: "numeric"
  });
}


function loadBookings() {
  fetch("/api/user-bookings")
    .then(res => res.json())
    .then(bookings => {
      const container = document.getElementById("bookingList");
      container.innerHTML = "";

      if (bookings.length === 0) {
        container.innerHTML = "<p>No bookings yet</p>";
        return;
      }

      bookings.forEach(b => {
        const card = document.createElement("div");
        card.className = "booking-card";

        card.innerHTML = `
          <div class="booking-title">${b.facility}</div>
          <div>${formatDate(b.date)}</div>
          <div>${b.court}</div>
          <div>${b.timeSlot}</div>
          <button class="cancel-btn" onclick="cancelBooking(${b.id})">Cancel</button>
        `;

        container.appendChild(card);
      });
    });
}


function cancelBooking(bookingId) {
  if (!confirm("Are you sure you want to cancel this booking?")) return;

  fetch("/api/cancel-booking", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ bookingId })
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      alert(data.message);
      loadBookings(); 
    } else {
      alert(data.message || "Failed to cancel booking");
    }
  })
  .catch(err => {
    console.error(err);
    alert("Error cancelling booking");
  });
}


window.onload = loadBookings;
</script>

<br>
<a href="/userbookings.html"><button>My Bookings</button></a>
<a href="/dashboard.html"><button>Back to Dashboard</button></a>
<a href="/logout"><button>Logout</button></a>

<br><br>




</body>
</html>